<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/6277f1a7f42c1288-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/bb3ef058b751a6ad-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/cd9ac437dbdb55e1.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/82ac9842c22a9525.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-3193b113389a5938.js"/><script src="/_next/static/chunks/fd9d1056-9f91b5e418130764.js" async=""></script><script src="/_next/static/chunks/117-e9bb1c308e93461a.js" async=""></script><script src="/_next/static/chunks/main-app-2cca24b979bb00c6.js" async=""></script><script src="/_next/static/chunks/app/layout-05bc13878bf2d84f.js" async=""></script><link rel="preload" href="https://analytics.ahrefs.com/analytics.js" as="script"/><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-NRKQPP7M9P" as="script"/><title>Searching multiple tables with one query with Laravel</title><meta name="description" content="Whilst developing the back-end for my final year project (redesign of Panasonic Global), I ran in to"/><meta name="creator" content="Alex Pate"/><meta name="publisher" content="Alex Pate"/><meta property="og:title" content="Searching multiple tables with one query with Laravel"/><meta property="og:description" content="Whilst developing the back-end for my final year project (redesign of Panasonic Global), I ran in to"/><meta property="og:url" content="https://alexpate.com/posts/searching-multiple-tables-laravel"/><meta property="og:site_name" content="Alex Pate - Product Engineer"/><meta property="og:image" content="https://alexpate.com/og.png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="Alex Pate - Product Engineer"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@alexjpate"/><meta name="twitter:creator:id" content="243263662"/><meta name="twitter:title" content="Searching multiple tables with one query with Laravel"/><meta name="twitter:description" content="Whilst developing the back-end for my final year project (redesign of Panasonic Global), I ran in to"/><meta name="twitter:image" content="https://alexpate.com/og.png"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><meta name="next-size-adjust"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Alex Pate","image":"https://alexpate.com/avatar.jpeg","url":"https://alexpate.com","jobTitle":"Product Engineer","sameAs":["https://twitter.com/alexjpate","https://www.github.com/alexpate","https://www.linkedin.com/in/alexjpate/"]}</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_57d908 __variable_3c557b bg-slate-50"><div class="max-w-2xl lg:max-w-xl mx-auto"><header class="pt-8 md:pt-16 pb-16 px-4 md:px-0 flex justify-between"><p></p></header><main class="px-4 md:px-0"><section><h1 class="font-semibold tracking-tight text-4xl text-slate-900">Searching multiple tables with one query with Laravel</h1><span class="text-slate-500 text-sm tracking-tight font-mono block mt-4">Published on<!-- --> <time dateTime="2015-06-12">11 Jun 2015</time></span></section><section class="py-5"><article class="prose prose-lg"><p>Whilst developing the back-end for my final year project (redesign of Panasonic Global), I ran in to the problem of how best to search multiple tables at once through the relationship models.</p>
<h2>The Problem</h2>
<p>Okay, so that&#x27;s probably not the best way to describe it. We have a search field that allows users to search for products by either the product name, or the product category. So searching for &#x27;cameras&#x27;, would show all of the cameras, where as searching for &#x27;Lumix DMC-GM1&#x27; should only show that individual product.</p>
<p>Here&#x27;s some basic context to the issue. We have two models (&#x27;Product&#x27;, and &#x27;Category&#x27;). They are joined on a one-to-many relationship:</p>
<pre><code class="hljs language-php"><span class="hljs-comment">// app/models/Product.php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span> </span>{
  ...

  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">category</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">belongsTo</span>(<span class="hljs-string">&#x27;Category&#x27;</span>, <span class="hljs-string">&#x27;product_category&#x27;</span>);
  }
}
</code></pre>
<pre><code class="hljs language-php"><span class="hljs-comment">// app/models/Category.php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Category</span> </span>{
  ...

  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">product</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">hasMany</span>(<span class="hljs-string">&#x27;Product&#x27;</span>, <span class="hljs-string">&#x27;category_id&#x27;</span>);
  }
}
</code></pre>
<p>(The public functions in each model provide us with a method to search a table through another table. For example, we can search for all categories via a product, which would only give us the categories that that individual product is in. This will be useful later.)</p>
<p>The data is stored in tables as such:</p>
<table><thead><tr><th>Products</th><th>Categories</th></tr></thead><tbody><tr><td><em>product_id</em></td><td><em>category_id</em></td></tr><tr><td>product_name</td><td>category_name</td></tr><tr><td>product_category *</td><td>category_slug</td></tr><tr><td>...</td><td>...</td></tr></tbody></table>
<p>The <code>product_category</code> refers to the <code>category_id</code>.</p>
<p>Of course this could be done relatively easily using multiple queries, however where possible it&#x27;s best to minimize the number of database queries we&#x27;re making.</p>
<h2>The Solution</h2>
<p>Here&#x27;s the final code:</p>
<pre><code class="hljs language-php"><span class="hljs-variable">$products</span> = <span class="hljs-title class_">Product</span>::<span class="hljs-title function_ invoke__">whereHas</span>(<span class="hljs-string">&#x27;category&#x27;</span>, function(<span class="hljs-variable">$query</span>) <span class="hljs-keyword">use</span>($<span class="hljs-title">term</span>) {
    $<span class="hljs-title">query</span>-&gt;<span class="hljs-title">where</span>(&#x27;<span class="hljs-title">category_name</span>&#x27;, &#x27;<span class="hljs-title">like</span>&#x27;, &#x27;%&#x27;.$<span class="hljs-title">term</span>.&#x27;%&#x27;);
})-&gt;<span class="hljs-title function_ invoke__">orWhere</span>(<span class="hljs-string">&#x27;product_name&#x27;</span>,<span class="hljs-string">&#x27;LIKE&#x27;</span>,<span class="hljs-string">&#x27;%&#x27;</span>.<span class="hljs-variable">$term</span>.<span class="hljs-string">&#x27;%&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">orderBy</span>(<span class="hljs-variable">$order</span>, <span class="hljs-string">&#x27;asc&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();
</code></pre>
<p>But let&#x27;s break it down a bit.</p>
<p>So first, we search for all products that have a related category. This is using the &#x27;category()&#x27; function that defined earlier in the Product Model. We use this to see if our query is &#x27;like&#x27; any of the related category names.</p>
<pre><code class="hljs language-php"><span class="hljs-title class_">Product</span>::<span class="hljs-title function_ invoke__">whereHas</span>(<span class="hljs-string">&#x27;category&#x27;</span>, function(<span class="hljs-variable">$query</span>) <span class="hljs-keyword">use</span>($<span class="hljs-title">term</span>) {
    $<span class="hljs-title">query</span>-&gt;<span class="hljs-title">where</span>(&#x27;<span class="hljs-title">category_name</span>&#x27;, &#x27;<span class="hljs-title">like</span>&#x27;, &#x27;%&#x27;.$<span class="hljs-title">term</span>.&#x27;%&#x27;);
})
</code></pre>
<p>If this returns no results, then we fall back to the second query, where we query the product directly, checking if the product name is like the search query:</p>
<pre><code class="hljs language-php">-&gt;<span class="hljs-title function_ invoke__">orWhere</span>(<span class="hljs-string">&#x27;product_name&#x27;</span>,<span class="hljs-string">&#x27;LIKE&#x27;</span>,<span class="hljs-string">&#x27;%&#x27;</span>.<span class="hljs-variable">$term</span>.<span class="hljs-string">&#x27;%&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();
</code></pre>
<p>Here&#x27;s a quick breakdown in pseudocode:</p>
<ul>
<li>User searches for something</li>
<li>First, find all products that are in categories, and match the search query against each category name.</li>
<li>If this returns any results, great!</li>
<li>Next, find all products that have a name containing the search query</li>
<li>If we have results, show them. Otherwise, show something else.</li>
</ul></article></section></main><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Searching multiple tables with one query with Laravel","url":"https://alexpate.com/posts/searching-multiple-tables-laravel","datePublished":"2015-06-12","dateModified":"2015-06-12","author":[{"@type":"Person","name":"Alex Pate","url":"https://alexpate.com"}]}</script><footer class="px-4 md:px-0 border-t border-slate-200 py-8 text-slate-700 font-mono text-xs tracking-tight flex justify-between"><p>© 2025 - <!-- -->2025<!-- --> <!-- -->/<!-- --> Brendan Royals</p></footer></div><script src="/_next/static/chunks/webpack-3193b113389a5938.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/6277f1a7f42c1288-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/bb3ef058b751a6ad-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/css/cd9ac437dbdb55e1.css\",\"style\"]\n4:HL[\"/_next/static/css/82ac9842c22a9525.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"5:I[2846,[],\"\"]\n8:I[4707,[],\"\"]\na:I[6423,[],\"\"]\nb:I[8003,[\"185\",\"static/chunks/app/layout-05bc13878bf2d84f.js\"],\"\"]\nc:I[8291,[\"185\",\"static/chunks/app/layout-05bc13878bf2d84f.js\"],\"Analytics\"]\nd:I[4888,[\"185\",\"static/chunks/app/layout-05bc13878bf2d84f.js\"],\"GoogleAnalytics\"]\nf:I[1060,[],\"\"]\n9:[\"slug\",\"searching-multiple-tables-laravel\",\"d\"]\n10:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L5\",null,{\"buildId\":\"W6ut7dmLYdtGKuHz2FDCD\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"posts\",\"searching-multiple-tables-laravel\"],\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"searching-multiple-tables-laravel\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"searching-multiple-tables-laravel\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"searching-multiple-tables-laravel\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L6\",\"$L7\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/82ac9842c22a9525.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]],null],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cd9ac437dbdb55e1.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Alex Pate\\\",\\\"image\\\":\\\"https://alexpate.com/avatar.jpeg\\\",\\\"url\\\":\\\"https://alexpate.com\\\",\\\"jobTitle\\\":\\\"Product Engineer\\\",\\\"sameAs\\\":[\\\"https://twitter.com/alexjpate\\\",\\\"https://www.github.com/alexpate\\\",\\\"https://www.linkedin.com/in/alexjpate/\\\"]}\"}}],[\"$\",\"$Lb\",null,{\"src\":\"https://analytics.ahrefs.com/analytics.js\",\"data-key\":\"Lp8HPBxSc/ujln/5tFmj3A\",\"defer\":true}]]}],[\"$\",\"body\",null,{\"className\":\"__className_57d908 __variable_3c557b bg-slate-50\",\"children\":[[\"$\",\"div\",null,{\"className\":\"max-w-2xl lg:max-w-xl mx-auto\",\"children\":[[\"$\",\"header\",null,{\"className\":\"pt-8 md:pt-16 pb-16 px-4 md:px-0 flex justify-between\",\"children\":[\"$\",\"p\",null,{}]}],[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}],[\"$\",\"footer\",null,{\"className\":\"px-4 md:px-0 border-t border-slate-200 py-8 text-slate-700 font-mono text-xs tracking-tight flex justify-between\",\"children\":[\"$\",\"p\",null,{\"children\":[\"© 2025 - \",2025,\" \",\"/\",\" Brendan Royals\"]}]}]]}],[\"$\",\"$Lc\",null,{}],[\"$\",\"$Ld\",null,{\"gaId\":\"G-NRKQPP7M9P\"}]]}]]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Le\"],\"globalErrorComponent\":\"$f\",\"missingSlots\":\"$W10\"}]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"main\",null,{\"className\":\"px-4 md:px-0\",\"children\":[[\"$\",\"section\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"font-semibold tracking-tight text-4xl text-slate-900\",\"children\":\"Searching multiple tables with one query with Laravel\"}],[\"$\",\"span\",null,{\"className\":\"text-slate-500 text-sm tracking-tight font-mono block mt-4\",\"children\":[\"Published on\",\" \",[\"$\",\"time\",null,{\"dateTime\":\"2015-06-12\",\"children\":\"11 Jun 2015\"}]]}]]}],[\"$\",\"section\",null,{\"className\":\"py-5\",\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-lg\",\"children\":\"$L11\"}]}]]}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Searching multiple tables with one query with Laravel\\\",\\\"url\\\":\\\"https://alexpate.com/posts/searching-multiple-tables-laravel\\\",\\\"datePublished\\\":\\\"2015-06-12\\\",\\\"dateModified\\\":\\\"2015-06-12\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Alex Pate\\\",\\\"url\\\":\\\"https://alexpate.com\\\"}]}\"}}]]\ne:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Searching multiple tables with one query with Laravel\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Whilst developing the back-end for my final year project (redesign of Panasonic Global), I ran in to\"}],[\"$\",\"meta\",\"4\",{\"name\":\"creator\",\"content\":\"Alex Pate\"}],[\"$\",\"meta\",\"5\",{\"name\":\"publisher\",\"content\":\"Alex Pate\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:title\",\"content\":\"Searching multiple tables with one query with Laravel\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:description\",\"content\":\"Whilst developing the back-end for my final year project (redesign of Panasonic Global), I ran in to\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:url\",\"content\":\"https://alexpate.com/posts/searching-multiple-tables-laravel\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:site_name\",\"content\":\"Alex Pate - Product Engineer\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:image\",\"content\":\"https://alexpate.com/og.p"])</script><script>self.__next_f.push([1,"ng\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:image:alt\",\"content\":\"Alex Pate - Product Engineer\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:creator\",\"content\":\"@alexjpate\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:creator:id\",\"content\":\"243263662\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:title\",\"content\":\"Searching multiple tables with one query with Laravel\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:description\",\"content\":\"Whilst developing the back-end for my final year project (redesign of Panasonic Global), I ran in to\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:image\",\"content\":\"https://alexpate.com/og.png\"}],[\"$\",\"link\",\"21\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"meta\",\"22\",{\"name\":\"next-size-adjust\"}]]\n6:null\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"p\",null,{\"children\":\"Whilst developing the back-end for my final year project (redesign of Panasonic Global), I ran in to the problem of how best to search multiple tables at once through the relationship models.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"The Problem\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Okay, so that's probably not the best way to describe it. We have a search field that allows users to search for products by either the product name, or the product category. So searching for 'cameras', would show all of the cameras, where as searching for 'Lumix DMC-GM1' should only show that individual product.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here's some basic context to the issue. We have two models ('Product', and 'Category'). They are joined on a one-to-many relationship:\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-php\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// app/models/Product.php\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-class\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"Product\"}],\" \"]}],\"{\\n  ...\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"category\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") \"]}],\"{\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"$$this\"}],\"-\u003e\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_ invoke__\",\"children\":\"belongsTo\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'Category'\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'product_category'\"}],\");\\n  }\\n}\\n\"]}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-php\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// app/models/Category.php\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-class\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"Category\"}],\" \"]}],\"{\\n  ...\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"product\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") \"]}],\"{\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"$$this\"}],\"-\u003e\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_ invoke__\",\"children\":\"hasMany\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'Product'\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'category_id'\"}],\");\\n  }\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"(The public functions in each model provide us with a method to search a table through another table. For example, we can search for all categories via a product, which would only give us the categories that that individual product is in. This will be useful later.)\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The data is stored in tables as such:\"}],\"\\n\",[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Products\"}],[\"$\",\"th\",null,{\"children\":\"Categories\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"em\",null,{\"children\":\"product_id\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"em\",null,{\"children\":\"category_id\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"product_name\"}],[\"$\",\"td\",null,{\"children\":\"category_name\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"product_category *\"}],[\"$\",\"td\",null,{\"children\":\"category_slug\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"...\"}],[\"$\",\"td\",null,{\"children\":\"...\"}]]}]]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"children\":\"product_category\"}],\" refers to the \",[\"$\",\"code\",null,{\"children\":\"category_id\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Of course this could be done relatively easily using multiple queries, however where possible it's best to minimize the number of database queries we're making.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"The Solution\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here's the final code:\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-php\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-variable\",\"children\":\"$$products\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Product\"}],\"::\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_ invoke__\",\"children\":\"whereHas\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'category'\"}],\", function(\",[\"$\",\"span\",null,{\"className\":\"hljs-variable\",\"children\":\"$$query\"}],\") \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"use\"}],\"($\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"term\"}],\") {\\n    $\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"query\"}],\"-\u003e\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"where\"}],\"('\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"category_name\"}],\"', '\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"like\"}],\"', '%'.$\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"term\"}],\".'%');\\n})-\u003e\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_ invoke__\",\"children\":\"orWhere\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'product_name'\"}],\",\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'LIKE'\"}],\",\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'%'\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-variable\",\"children\":\"$$term\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'%'\"}],\")-\u003e\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_ invoke__\",\"children\":\"orderBy\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-variable\",\"children\":\"$$order\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'asc'\"}],\")-\u003e\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_ invoke__\",\"children\":\"get\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"But let's break it down a bit.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"So first, we search for all products that have a related category. This is using the 'category()' function that defined earlier in the Product Model. We use this to see if our query is 'like' any of the related category names.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-php\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Product\"}],\"::\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_ invoke__\",\"children\":\"whereHas\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'category'\"}],\", function(\",[\"$\",\"span\",null,{\"className\":\"hljs-variable\",\"children\":\"$$query\"}],\") \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"use\"}],\"($\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"term\"}],\") {\\n    $\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"query\"}],\"-\u003e\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"where\"}],\"('\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"category_name\"}],\"', '\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"like\"}],\"', '%'.$\",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"term\"}],\".'%');\\n})\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"If this returns no results, then we fall back to the second query, where we query the product directly, checking if the product name is like the search query:\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-php\",\"children\":[\"-\u003e\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_ invoke__\",\"children\":\"orWhere\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'product_name'\"}],\",\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'LIKE'\"}],\",\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'%'\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-variable\",\"children\":\"$$term\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'%'\"}],\")-\u003e\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_ invoke__\",\"children\":\"get\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here's a quick breakdown in pseudocode:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"User searches for something\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"First, find all products that are in categories, and match the search query against each category name.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"If this returns any results, great!\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Next, find all products that have a name containing the search query\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"If we have results, show them. Otherwise, show something else.\"}],\"\\n\"]}]]\n"])</script></body></html>