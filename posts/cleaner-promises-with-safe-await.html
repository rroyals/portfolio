<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/6277f1a7f42c1288-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/bb3ef058b751a6ad-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/cd9ac437dbdb55e1.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/82ac9842c22a9525.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-3193b113389a5938.js"/><script src="/_next/static/chunks/fd9d1056-9f91b5e418130764.js" async=""></script><script src="/_next/static/chunks/117-e9bb1c308e93461a.js" async=""></script><script src="/_next/static/chunks/main-app-2cca24b979bb00c6.js" async=""></script><script src="/_next/static/chunks/app/layout-05bc13878bf2d84f.js" async=""></script><link rel="preload" href="https://analytics.ahrefs.com/analytics.js" as="script"/><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-NRKQPP7M9P" as="script"/><title>Cleaner JavaScript promises with safe-await</title><meta name="description" content="Explore how the safe-await pattern can simplify handling JavaScript promises, making code cleaner and more maintainable."/><meta name="creator" content="Alex Pate"/><meta name="publisher" content="Alex Pate"/><meta property="og:title" content="Cleaner JavaScript promises with safe-await"/><meta property="og:description" content="Explore how the safe-await pattern can simplify handling JavaScript promises, making code cleaner and more maintainable."/><meta property="og:url" content="https://alexpate.com/posts/cleaner-promises-with-safe-await"/><meta property="og:site_name" content="Alex Pate - Product Engineer"/><meta property="og:image" content="https://alexpate.com/og.png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="Alex Pate - Product Engineer"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@alexjpate"/><meta name="twitter:creator:id" content="243263662"/><meta name="twitter:title" content="Cleaner JavaScript promises with safe-await"/><meta name="twitter:description" content="Explore how the safe-await pattern can simplify handling JavaScript promises, making code cleaner and more maintainable."/><meta name="twitter:image" content="https://alexpate.com/og.png"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><meta name="next-size-adjust"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Alex Pate","image":"https://alexpate.com/avatar.jpeg","url":"https://alexpate.com","jobTitle":"Product Engineer","sameAs":["https://twitter.com/alexjpate","https://www.github.com/alexpate","https://www.linkedin.com/in/alexjpate/"]}</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_57d908 __variable_3c557b bg-slate-50"><div class="max-w-2xl lg:max-w-xl mx-auto"><header class="pt-8 md:pt-16 pb-16 px-4 md:px-0 flex justify-between"><p></p></header><main class="px-4 md:px-0"><section><h1 class="font-semibold tracking-tight text-4xl text-slate-900">Cleaner JavaScript promises with safe-await</h1><span class="text-slate-500 text-sm tracking-tight font-mono block mt-4">Published on<!-- --> <time dateTime="2024-05-22">21 May 2024</time></span></section><section class="py-5"><article class="prose prose-lg"><p>Nested try/catch blocks are a common pattern in JavaScript when working with promises. However, they often lead to hard-to-read and maintain code.</p>
<p>To better understand the problem, let&#x27;s look at an example where we have a series of promises, each relying on the result of the previous one <em>(or if you just want to skip to the solution, <a href="#solution">click here</a>!)</em></p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doSomething</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">someFunction</span>();
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> anotherResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">anotherFunction</span>(result);
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> finalResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">finalFunction</span>(anotherResult);
        <span class="hljs-keyword">return</span> finalResult;
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
      }
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
    }
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  }
}
</code></pre>
<h4>What&#x27;s the Problem?</h4>
<p>This code is hard to read and maintain. The final return result is buried halfway through the script, making it difficult to trace error handling. Although each try/catch block is small here, in a real-world application, they might contain much more code.</p>
<h4>A Better Pattern: Single try/catch Block</h4>
<p>One way to clean this up is to use a single try/catch block around the entire promise chain:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doSomething</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">someFunction</span>();
    <span class="hljs-keyword">const</span> anotherResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">anotherFunction</span>(result);
    <span class="hljs-keyword">const</span> finalResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">finalFunction</span>(anotherResult);
    <span class="hljs-keyword">return</span> finalResult;
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  }
}
</code></pre>
<p>This approach is an improvement, but it still has a drawback: handling all errors in a single catch block can obscure where the error originated.</p>
<h3>The Go Error Handling Pattern</h3>
<p>At Monzo, I was introduced to Go, where errors are always returned from functions, allowing for multiple return values that include both the result and the error. Here&#x27;s how the previous example would look using the Go error handling pattern:</p>
<pre><code class="hljs language-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span></span> (finalResult, <span class="hljs-type">error</span>) {
  result, err := someFunction()
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
  }

  anotherResult, err := anotherFunction(result)
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
  }

  finalResult, err := finalFunction(anotherResult)
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
  }

  <span class="hljs-keyword">return</span> finalResult, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>This pattern makes it easy to see where errors are being returned and handle them accordingly.</p>
<span id="solution"></span>
<h3>Back to JavaScript: The Safe-Await Pattern</h3>
<p>Recently, I discovered the <a href="https://github.com/DavidWells/safe-await">safe-await</a>
package, which provides a similar pattern for JavaScript promises. Here&#x27;s how we
can rewrite our example using safe-await:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doSomething</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> [error1, result] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">safeAwait</span>(<span class="hljs-title function_">someFunction</span>());
  <span class="hljs-keyword">if</span> (error1) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error1);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">const</span> [error2, anotherResult] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">safeAwait</span>(<span class="hljs-title function_">anotherFunction</span>(result));
  <span class="hljs-keyword">if</span> (error2) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error2);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">const</span> [error3, finalResult] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">safeAwait</span>(<span class="hljs-title function_">finalFunction</span>(anotherResult));
  <span class="hljs-keyword">if</span> (error3) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error3);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">return</span> finalResult;
}
</code></pre>
<p>Although this pattern is slightly more verbose, it is much easier to read and maintain.</p>
<p>While I have found the safe-await pattern useful in my codebases, it’s important to consider what’s best for your team and project. This pattern provides a clearer structure for handling asynchronous operations and errors, but you should always consider the trade-offs when introducing new patterns to your codebase.</p>
<h3>Credits</h3>
<ul>
<li>David Wells for the <a href="https://www.npmjs.com/package/safe-await">safe-await</a> package.</li>
</ul></article></section></main><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cleaner JavaScript promises with safe-await","url":"https://alexpate.com/posts/cleaner-promises-with-safe-await","datePublished":"2024-05-22","dateModified":"2024-05-22","author":[{"@type":"Person","name":"Alex Pate","url":"https://alexpate.com"}]}</script><footer class="px-4 md:px-0 border-t border-slate-200 py-8 text-slate-700 font-mono text-xs tracking-tight flex justify-between"><p>© 2025 - <!-- -->2025<!-- --> <!-- -->/<!-- --> Brendan Royals</p></footer></div><script src="/_next/static/chunks/webpack-3193b113389a5938.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/6277f1a7f42c1288-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/bb3ef058b751a6ad-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/css/cd9ac437dbdb55e1.css\",\"style\"]\n4:HL[\"/_next/static/css/82ac9842c22a9525.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"5:I[2846,[],\"\"]\n8:I[4707,[],\"\"]\na:I[6423,[],\"\"]\nb:I[8003,[\"185\",\"static/chunks/app/layout-05bc13878bf2d84f.js\"],\"\"]\nc:I[8291,[\"185\",\"static/chunks/app/layout-05bc13878bf2d84f.js\"],\"Analytics\"]\nd:I[4888,[\"185\",\"static/chunks/app/layout-05bc13878bf2d84f.js\"],\"GoogleAnalytics\"]\nf:I[1060,[],\"\"]\n9:[\"slug\",\"cleaner-promises-with-safe-await\",\"d\"]\n10:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L5\",null,{\"buildId\":\"W6ut7dmLYdtGKuHz2FDCD\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"posts\",\"cleaner-promises-with-safe-await\"],\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"cleaner-promises-with-safe-await\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"cleaner-promises-with-safe-await\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"cleaner-promises-with-safe-await\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L6\",\"$L7\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/82ac9842c22a9525.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]],null],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cd9ac437dbdb55e1.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Alex Pate\\\",\\\"image\\\":\\\"https://alexpate.com/avatar.jpeg\\\",\\\"url\\\":\\\"https://alexpate.com\\\",\\\"jobTitle\\\":\\\"Product Engineer\\\",\\\"sameAs\\\":[\\\"https://twitter.com/alexjpate\\\",\\\"https://www.github.com/alexpate\\\",\\\"https://www.linkedin.com/in/alexjpate/\\\"]}\"}}],[\"$\",\"$Lb\",null,{\"src\":\"https://analytics.ahrefs.com/analytics.js\",\"data-key\":\"Lp8HPBxSc/ujln/5tFmj3A\",\"defer\":true}]]}],[\"$\",\"body\",null,{\"className\":\"__className_57d908 __variable_3c557b bg-slate-50\",\"children\":[[\"$\",\"div\",null,{\"className\":\"max-w-2xl lg:max-w-xl mx-auto\",\"children\":[[\"$\",\"header\",null,{\"className\":\"pt-8 md:pt-16 pb-16 px-4 md:px-0 flex justify-between\",\"children\":[\"$\",\"p\",null,{}]}],[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}],[\"$\",\"footer\",null,{\"className\":\"px-4 md:px-0 border-t border-slate-200 py-8 text-slate-700 font-mono text-xs tracking-tight flex justify-between\",\"children\":[\"$\",\"p\",null,{\"children\":[\"© 2025 - \",2025,\" \",\"/\",\" Brendan Royals\"]}]}]]}],[\"$\",\"$Lc\",null,{}],[\"$\",\"$Ld\",null,{\"gaId\":\"G-NRKQPP7M9P\"}]]}]]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Le\"],\"globalErrorComponent\":\"$f\",\"missingSlots\":\"$W10\"}]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"main\",null,{\"className\":\"px-4 md:px-0\",\"children\":[[\"$\",\"section\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"font-semibold tracking-tight text-4xl text-slate-900\",\"children\":\"Cleaner JavaScript promises with safe-await\"}],[\"$\",\"span\",null,{\"className\":\"text-slate-500 text-sm tracking-tight font-mono block mt-4\",\"children\":[\"Published on\",\" \",[\"$\",\"time\",null,{\"dateTime\":\"2024-05-22\",\"children\":\"21 May 2024\"}]]}]]}],[\"$\",\"section\",null,{\"className\":\"py-5\",\"children\":[\"$\",\"article\",null,{\"className\":\"prose prose-lg\",\"children\":\"$L11\"}]}]]}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Cleaner JavaScript promises with safe-await\\\",\\\"url\\\":\\\"https://alexpate.com/posts/cleaner-promises-with-safe-await\\\",\\\"datePublished\\\":\\\"2024-05-22\\\",\\\"dateModified\\\":\\\"2024-05-22\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Alex Pate\\\",\\\"url\\\":\\\"https://alexpate.com\\\"}]}\"}}]]\ne:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Cleaner JavaScript promises with safe-await\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Explore how the safe-await pattern can simplify handling JavaScript promises, making code cleaner and more maintainable.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"creator\",\"content\":\"Alex Pate\"}],[\"$\",\"meta\",\"5\",{\"name\":\"publisher\",\"content\":\"Alex Pate\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:title\",\"content\":\"Cleaner JavaScript promises with safe-await\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:description\",\"content\":\"Explore how the safe-await pattern can simplify handling JavaScript promises, making code cleaner and more maintainable.\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:url\",\"content\":\"https://alexpate.com/posts/cleaner-promises-with-safe-await\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:site_name\",\"content\":\"Alex Pate - Product Engineer\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:image\",\"content\":\"https://alexpate.com/og.png"])</script><script>self.__next_f.push([1,"\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:image:alt\",\"content\":\"Alex Pate - Product Engineer\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:creator\",\"content\":\"@alexjpate\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:creator:id\",\"content\":\"243263662\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:title\",\"content\":\"Cleaner JavaScript promises with safe-await\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:description\",\"content\":\"Explore how the safe-await pattern can simplify handling JavaScript promises, making code cleaner and more maintainable.\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:image\",\"content\":\"https://alexpate.com/og.png\"}],[\"$\",\"link\",\"21\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"meta\",\"22\",{\"name\":\"next-size-adjust\"}]]\n6:null\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"p\",null,{\"children\":\"Nested try/catch blocks are a common pattern in JavaScript when working with promises. However, they often lead to hard-to-read and maintain code.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"To better understand the problem, let's look at an example where we have a series of promises, each relying on the result of the previous one \",[\"$\",\"em\",null,{\"children\":[\"(or if you just want to skip to the solution, \",[\"$\",\"a\",null,{\"href\":\"#solution\",\"children\":\"click here\"}],\"!)\"]}]]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"doSomething\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"try\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" result = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"someFunction\"}],\"();\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"try\"}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" anotherResult = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"anotherFunction\"}],\"(result);\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"try\"}],\" {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" finalResult = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"finalFunction\"}],\"(anotherResult);\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" finalResult;\\n      } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"catch\"}],\" (err) {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"error\"}],\"(err);\\n      }\\n    } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"catch\"}],\" (err) {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"error\"}],\"(err);\\n    }\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"catch\"}],\" (err) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"error\"}],\"(err);\\n  }\\n}\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"What's the Problem?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This code is hard to read and maintain. The final return result is buried halfway through the script, making it difficult to trace error handling. Although each try/catch block is small here, in a real-world application, they might contain much more code.\"}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"A Better Pattern: Single try/catch Block\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"One way to clean this up is to use a single try/catch block around the entire promise chain:\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"doSomething\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"try\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" result = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"someFunction\"}],\"();\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" anotherResult = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"anotherFunction\"}],\"(result);\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" finalResult = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"finalFunction\"}],\"(anotherResult);\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" finalResult;\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"catch\"}],\" (err) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"error\"}],\"(err);\\n  }\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This approach is an improvement, but it still has a drawback: handling all errors in a single catch block can obscure where the error originated.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"The Go Error Handling Pattern\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"At Monzo, I was introduced to Go, where errors are always returned from functions, allowing for multiple return values that include both the result and the error. Here's how the previous example would look using the Go error handling pattern:\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-go\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"func\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title\",\"children\":\"doSomething\"}],[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"()\"}]]}],\" (finalResult, \",[\"$\",\"span\",null,{\"className\":\"hljs-type\",\"children\":\"error\"}],\") {\\n  result, err := someFunction()\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" err != \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"nil\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"nil\"}],\", err\\n  }\\n\\n  anotherResult, err := anotherFunction(result)\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" err != \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"nil\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"nil\"}],\", err\\n  }\\n\\n  finalResult, err := finalFunction(anotherResult)\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" err != \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"nil\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"nil\"}],\", err\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" finalResult, \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"nil\"}],\"\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This pattern makes it easy to see where errors are being returned and handle them accordingly.\"}],\"\\n\",[\"$\",\"span\",null,{\"id\":\"solution\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Back to JavaScript: The Safe-Await Pattern\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Recently, I discovered the \",[\"$\",\"a\",null,{\"href\":\"https://github.com/DavidWells/safe-await\",\"children\":\"safe-await\"}],\"\\npackage, which provides a similar pattern for JavaScript promises. Here's how we\\ncan rewrite our example using safe-await:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"doSomething\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" [error1, result] = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"safeAwait\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"someFunction\"}],\"());\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (error1) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"error\"}],\"(error1);\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\";\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" [error2, anotherResult] = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"safeAwait\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"anotherFunction\"}],\"(result));\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (error2) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"error\"}],\"(error2);\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\";\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" [error3, finalResult] = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"safeAwait\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"finalFunction\"}],\"(anotherResult));\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (error3) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"error\"}],\"(error3);\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\";\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" finalResult;\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Although this pattern is slightly more verbose, it is much easier to read and maintain.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"While I have found the safe-await pattern useful in my codebases, it’s important to consider what’s best for your team and project. This pattern provides a clearer structure for handling asynchronous operations and errors, but you should always consider the trade-offs when introducing new patterns to your codebase.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Credits\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"David Wells for the \",[\"$\",\"a\",null,{\"href\":\"https://www.npmjs.com/package/safe-await\",\"children\":\"safe-await\"}],\" package.\"]}],\"\\n\"]}]]\n"])</script></body></html>